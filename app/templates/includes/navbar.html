<nav class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50 p-3 transition-colors duration-300">
    <div class="max-w-4xl mx-auto flex justify-between items-center px-4">
        
        <a href="/" class="flex items-center group no-tap">
            <span class="text-2xl mr-2">üìñ</span>
            <h1 class="text-xl font-black tracking-tighter text-blue-600 dark:text-blue-500 uppercase group-hover:text-blue-400 transition-colors">
                familybook
            </h1>
        </a>

        <div class="flex items-center space-x-3 sm:space-x-4">
            
            <button onclick="toggleTheme()" 
                    class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 hover:ring-2 ring-blue-500 transition-all active:scale-90 no-tap"
                    title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <span class="dark:hidden text-lg">üåô</span>
                <span class="hidden dark:inline text-lg">‚òÄÔ∏è</span>
            </button>

            {% if user %}
                <div class="hidden md:flex flex-col items-end leading-none">
                    <span class="text-slate-900 dark:text-white text-sm font-bold">{{ user.display_name }}</span>
                    {% if user.username == 'admin' or user.role == 'admin' %}
                        <span class="text-[9px] text-amber-600 dark:text-amber-400 uppercase font-black tracking-widest mt-0.5">–ê–¥–º–∏–Ω üõ†Ô∏è</span>
                    {% endif %}
                </div>

                <div class="relative" x-data="{ open: false }">
                    <button @click="open = !open" @click.outside="open = false"
                            class="flex items-center space-x-2 p-1 pr-3 rounded-full bg-slate-100 dark:bg-slate-800 hover:ring-2 ring-blue-500 transition-all group no-tap">
                        <img src="{{ user.avatar_url or 'https://ui-avatars.com/api/?background=2563eb&color=fff&name=' + user.display_name|urlencode }}" 
                             alt="Avatar"
                             class="w-9 h-9 rounded-full border-2 border-slate-200 dark:border-slate-700 object-cover group-hover:border-blue-500 transition-all">
                        <span class="text-xs font-bold text-slate-500 dark:text-slate-400" :class="open ? 'rotate-180' : ''">‚ñº</span>
                    </button>

                    <div x-show="open" 
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95 -translate-y-2"
                         x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                         class="absolute right-0 mt-3 w-56 bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-800 p-2 z-50 shadow-blue-500/10"
                         style="display: none;">
                        
                        <div class="px-4 py-2 text-[10px] text-slate-400 uppercase font-bold tracking-wider">–ê–∫–∫–∞—É–Ω—Ç</div>
                        
                        <a href="/profile/{{ user.username }}" class="flex items-center px-4 py-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-medium text-slate-700 dark:text-slate-200 transition-colors">
                            <span class="mr-3">üë§</span> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                        </a>
                        
                        <a href="/settings" class="flex items-center px-4 py-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-medium text-slate-700 dark:text-slate-200 transition-colors">
                            <span class="mr-3">‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        </a>
                        
                        <hr class="border-slate-100 dark:border-slate-800 my-1 mx-2">
                        
                        <a href="/logout" class="flex w-full items-center px-4 py-2.5 rounded-xl hover:bg-red-50 dark:hover:bg-red-950/30 text-sm font-bold text-red-600 transition-colors">
                            <span class="mr-3">üö™</span> –í—ã–π—Ç–∏
                        </a>
                    </div>
                </div>

            {% else %}
                <div class="flex items-center space-x-2">
                    <a href="/login" class="text-sm text-blue-600 dark:text-blue-500 font-bold hover:underline px-2">–í–æ–π—Ç–∏</a>
                    <a href="/register" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-500/20 active:scale-95">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                </div>
            {% endif %}
        </div>
    </div>
</nav>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã (—Ñ—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑–≤–Ω–µ)
function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
}

</script>