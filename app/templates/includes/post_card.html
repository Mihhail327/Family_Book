<article class="post-card bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden mb-6 transition-all relative hover:shadow-md" id="post-{{ post.id }}">
    
    <div class="p-4 flex items-center justify-between">
        <div class="flex items-center space-x-3">
            <img src="{{ post.author.avatar_url or '/static/default_avatar.png' }}" 
                 class="w-10 h-10 rounded-full border border-slate-100 dark:border-slate-700 object-cover">
            <div>
                <p class="font-bold text-slate-900 dark:text-slate-100 text-sm">{{ post.author.display_name }}</p>
                <p class="text-[10px] text-slate-400 uppercase">{{ post.created_at.strftime('%d.%m ‚Ä¢ %H:%M') if post.created_at else '–¢–æ–ª—å–∫–æ —á—Ç–æ' }}</p>
            </div>
        </div>
    </div>

    <div class="relative px-4 pb-4">
        
        {# –ï—Å–ª–∏ –ø–æ—Å—Ç - –ø–æ–¥–∞—Ä–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ—Ä—Ç–∫—É #}
        {% if post.is_gift %}
        <div id="gift-overlay-{{ post.id }}" 
             onclick="revealGift('{{ post.id }}')"
             class="absolute inset-x-4 inset-y-0 z-30 bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-700 rounded-2xl flex flex-col items-center justify-center text-white cursor-pointer transition-all duration-700 shadow-lg group">
            
            <div class="text-5xl mb-3 group-hover:scale-125 transition-transform duration-500">üéÅ</div>
            <p class="font-black uppercase tracking-widest text-[10px] mb-1">–°—é—Ä–ø—Ä–∏–∑ –¥–ª—è —Å–µ–º—å–∏</p>
            <p class="text-xs font-medium opacity-80">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</p>
            
        </div>
        {% endif %}

        <a href="/posts/{{ post.id }}" class="block {% if post.is_gift %}blur-3xl opacity-50 grayscale transition-all duration-1000{% endif %}" id="grid-{{ post.id }}">
            {% if post.content %}
                <p class="text-slate-700 dark:text-slate-300 text-sm mb-3 line-clamp-3">{{ post.content }}</p>
            {% endif %}

            {% if post.images %}
                <div class="grid gap-1 rounded-2xl overflow-hidden {% if post.images|length > 1 %}grid-cols-2{% else %}grid-cols-1{% endif %}">
                    {% for img in post.images[:4] %}
                        <img src="{{ img.url }}" class="w-full h-48 object-cover">
                    {% endfor %}
                </div>
            {% endif %}
        </a>
    </div>

    <div class="border-t border-slate-50 dark:border-slate-800/50 p-1 flex">
        <button onclick="toggleLike(this, '{{ post.id }}')" class="flex-1 py-3 flex items-center justify-center space-x-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition-all">
            <span class="heart-icon">{% if user in post.likers %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
            <span class="count font-bold text-sm">{{ post.likers|length }}</span>
        </button>

        <a href="/posts/{{ post.id }}#comments" class="flex-1 py-3 flex items-center justify-center space-x-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition-all">
            <span>üí¨</span>
            <span class="font-bold text-sm text-slate-500">{{ post.comments|length }}</span>
        </a>
    </div>
</article>

<script>
if (typeof revealGift !== 'function') {
    window.revealGift = function(postId) {
        const overlay = document.getElementById('gift-overlay-' + postId);
        const grid = document.getElementById('grid-' + postId);

        if (overlay) {
            // –ó–∞–ø—É—Å–∫ —Å–∞–ª—é—Ç–∞ –ø—Ä–∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ
            if (typeof confetti === 'function') {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#2563eb', '#6366f1', '#a855f7'],
                    zIndex: 9999
                });
            }
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            overlay.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
            // –£–±–∏—Ä–∞–µ–º –±–ª—é—Ä
            if (grid) grid.classList.remove('blur-3xl', 'opacity-50', 'grayscale');
            // –£–¥–∞–ª—è–µ–º –∏–∑ DOM
            setTimeout(() => overlay.remove(), 1000);
        }
    };
}
</script>